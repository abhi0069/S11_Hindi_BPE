import regex as re
import torch
from collections import defaultdict

# Hindi-specific regex pattern
# \u0900-\u097F is the Devanagari Unicode block
hindi_pattern = re.compile(r"""
    [\u0900-\u097F]+  # Hindi characters
    |[\s]+            # whitespace
    |[।॥॰]           # Hindi punctuation
    |[^\s]+          # anything else
""", re.VERBOSE)

# Hindi text dataset
hindi_text = """
पुरातत्व प्रमाणों के अनुसार, मूल निवासी कोई 10,000 साल पहले पहली बार हिमनद क्षेत्र में आए थे। ब्लैकफ़ीट जनजाति अब उद्यान के हिस्से हो चुके पूर्वी ढलान के साथ-साथ पूर्व की ओर ग्रेट प्लेन निवास करती थी।[6] उद्यान की पूर्वी सीमा पर आज ब्लैकफ़ीट इंडियन अभ्यारण्य है जबकि फ्लेथेड इंडियन अभ्यारण्य उद्यान के पश्चिम और दक्षिण में स्थित है। 1895 में ब्लैकफ़ीट के मुखिया व्हाइट कॉफ़ ने अमेरिकी सरकार को लगभग 800,000 एकड़ का पर्वतीय क्षेत्र, 15 लाख डॉलर में बिक्री के लिए अधिकृत किया। इस शर्त पर कि जब तक कि यह संयुक्त राज्य की सार्वजनिक भूमि रहेगी, वह लंबे समय तक भूमि का उपयोग शिकार के लिए कर सकेगें।[7] इससे उद्यान और अभ्यारण्य के बीच वर्तमान सीमा की स्थापना हुई।


गोइंग-टू-सन रोड निर्माण के दौरान सड़क निर्माण, 1932
1806 में मैरियास नदी में सफ़र करते हुए, लुईस और क्लार्क अभियान उस क्षेत्र के 50 मील (80 किमी) के भीतर तक आ गए थे जो अब उद्यान है।[8] 1850 के बाद खोज की एक शृंखला ने उस क्षेत्र की समझ को आकार देने में मदद की जो बाद में उद्यान बन गया। 1885 में जॉर्ज बर्ड ग्रिनल ने प्रसिद्ध खोजकर्ता (और बाद में जाने-माने लेखक) जेम्स विलार्ड शुल्ज़ को इस क्षेत्र में एक शिकार अभियान में मार्गदर्शन करने के लिए काम पर रखा।[9] इस क्षेत्र में कई और यात्राओं के बाद, ग्रिनेल यहां के परिदृश्यों से इतना प्रेरित हो गए कि उन्होंने अगले दो दशकों इसे राष्ट्रीय उद्यान के रूप में स्थापित करने के लिए बिताए। 1901 में ग्रिनेल ने उस क्षेत्र का वर्णन लिखा जिसमें उन्होंने इसे "क्राउन ऑफ़ द कॉन्टिनेंट" कहा था। भूमि की रक्षा के उनके प्रयासों ने उन्हें इस अभियान का प्रमुख योगदानकर्ता बना दिया।[10]


लोगन पास के पश्चिम में गोइंग-टू-सन रोड के पास
1891 में ग्रेट नॉर्दर्न रेलवे ने 5,213 फीट (1,589 मीटर) पर मैरियास दर्रे पर महाद्वीपीय विभाजन तक पहुँच बनाई जो कि उद्यान की दक्षिणी सीमा बनाता है। 1897 में उद्यान को वन संरक्षण के रूप में नामित किया गया था।[11] वन होते हुए भी खनन की अनुमति अभी भी थी, लेकिन व्यावसायिक रूप से सफल नहीं हो सकी। 1910 में, अमेरिकी कांग्रेस में एक बिल पेश किया गया था जिसमें इस क्षेत्र को राष्ट्रीय उद्यान नामित किया था। इस बिल पर 1910 में राष्ट्रपति विलियम होवर टाफ्ट ने हस्ताक्षर कर इसे क़ानून में बदल दिया।[12] द ग्रेट नॉर्थ रेलवे ने अध्यक्ष लुइस डब्ल्यू हिल की देखरेख में 1910 के दशक में पूरे क्षेत्र में पर्यटन को बढ़ावा देने के लिए कई होटल और शैले बनाए। इन इमारतों को हिमनद को "अमेरिका का स्विट्जरलैंड" के रूप में चित्रित करने की योजना के तहत इन्हें स्विस वास्तुकला पर बनाया गया था।[13]


उद्यान में स्थित स्पेरी शैलेट
जब उद्यान पूरी तरह विकसित हो गया और आगंतुकों ने गाड़ियों से आना-जाना शुरू कर दिया तो 53-मील (85 किमी) लंबा "गोइंग-टू-द-सन रोड" पर काम शुरू किया गया। यह 1932 में पूरा हुआ। इसे "सन रोड" के रूप में भी जाना जाता है। यह एकमात्र सड़क है जो उद्यान के अंदर जाती है। सन रोड ऐतिहासिक स्थलों के राष्ट्रीय रजिस्टर में भी सूचीबद्ध है और 1985 में इसे एक राष्ट्रीय ऐतिहासिक सिविल इंजीनियरिंग लैंडमार्क के रूप में नामित किया गया था।[14] पार्क और राष्ट्रीय वन के बीच दक्षिणी सीमा के साथ एक और मार्ग, यूएस रूट 2 है, जो मैरियास दर्रे पर महाद्वीपीय विभाजन को पार करता है और वेस्ट ग्लेशियर और ईस्ट ग्लेशियर के शहरों को जोड़ता है।

भूगोल और भूविज्ञान

सर्दियों के दौरान फ्लेथेड नदी
यह उद्यान उत्तर में अल्बर्टा के वॉटरटन झील राष्ट्रीय उद्यान और ब्रिटिश कोलंबिया के फ्लैथहेड प्रांतीय वन और अकामिना-किशनिना प्रांतीय उद्यान से घिरा है।[15] पश्चिम में, फ्लेथेड नदी की उत्तरी धारा पश्चिमी सीमा बनाती है जबकि इसकी मध्य धारा दक्षिणी सीमा का हिस्सा है। ब्लैकफेट इंडियन अभ्यारण्य अधिकांश पूर्वी सीमा बनाता है। लुईस और क्लार्क और फ्लैथहेड राष्ट्रीय वन दक्षिणी और पश्चिमी सीमा बनाते हैं।[16]

उद्यान में एक दर्जन बड़ी और 700 छोटी झीलें हैं लेकिन उनमें से केवल 131 झीलों के नाम हैं।[17] उद्यान के पश्चिमी तरफ मैकडॉनल्ड झील 9.4 मील (15.1 किमी) के साथ सबसे लंबी, 6,823 एकड़ (27.61 किमी 2) क्षेत्र के साथ में सबसे बड़ी और 464 फीट (141 मीटर) के साथ सबसे गहरी झील है। कई छोटी झीलें, जिन्हें टार्न्स के रूप में जाना जाता है, हिमनदों के कटाव से बनने वाली हिमगह्वर में स्थित हैं। हिमस्खलन झील और क्रैकर झील जैसी इन झीलों में से कुछ, निलंबित ग्लेशियल गाद के कारण यह एक अपारदर्शी फ़िरोज़ा रंग की हैं। इसी के कारण झीलो से निकलने वाली कई धाराएँ दूधिया सफ़ेद रंग की दिखाई देती हैं। ग्लेशियर नेशनल पार्क की झीलें साल भर ठंडी रहती हैं। उनकी सतह पर तापमान शायद ही कभी 50°F (10°C) से ऊपर जाता हो।[17] इस प्रकार की ठंडे पानी की झीलें, प्लवक वृद्धि के लिए अनुकूलित होती हैं, जिसके कारण झील का पानी उल्लेखनीय रूप से पारदर्शी होता है। प्लवक की कमी से, प्रदूषण निस्पंदन की दर को कम हो जाती है। जिसके कारण प्रदूषकों के पानी में रहने की अवधि बढ़ जाती है। नतीजतन, झीलों को पर्यावरण प्रदूषण मापन में अग्रणी माना जाता है क्योंकि वे प्रदूषकों में मामूली वृद्धि से भी जल्दी प्रभावित हो सकती हैं।[18]


टू मेडिसिन झील और सिनपोह पर्वत
पूरे उद्यान में दो सौ झरने फैले हुए हैं। हालांकि, सूखे के अवधि के दौरान, इनमें से कई एक छोटी धाराओं में सिमट जाती हैं। सबसे बड़े जलप्रपातों में टू मेडिसिन क्षेत्र में मैकडॉनल्ड्स जलप्रपात और मेनी हिमनद क्षेत्र में स्विफ्टक्रंट जलप्रपात शामिल हैं। इन्हें आसानी से देखा जा सकता है और इसके पास कई ग्लेशियर होटल मौजूद है। सबसे ऊँचे झरनों में से एक बर्ड वुमन जलप्रपात है, जो ओबेरलिन पर्वत के उत्तरी ढलान के नीचे एक लटकती घाटी से 492 फीट (150 मीटर) नीचे गिरती है।[19]

उद्यान में पाई जाने वाली चट्टानें मुख्य रूप से बेल्ट सुपरग्रुप की तलछटी चट्टानें हैं। वे 1.6 अरब से 800 मिलियन वर्ष पहले उथले समुद्रों में जमा हो गए थे। रॉकी पर्वत के निर्माण के दौरान 170 मिलियन साल पहले, चट्टानों के एक क्षेत्र को जिसे अब लुईस ओवरथ्रस्ट के रूप में जाना जाता है, 50 मील (80 कि॰मी॰) पूर्व की ओर खिसक गया था। यह ओवरथ्रेस्ट कई मील (किलोमीटर) मोटा और सैकड़ों मील (किलोमीटर) लंबा था।
"""

# Use Hindi-specific regex to tokenize first, then convert to bytes
tokens = []
for match in hindi_pattern.findall(hindi_text):
    if match.strip():  # Skip empty matches
        tokens.extend(list(match.encode('utf-8')))
tokens = list(map(int, tokens))

def get_stats(ids):
    # Exactly as in ERA_V3 code
    counts = {}
    for pair in zip(ids, ids[1:]):
        counts[pair] = counts.get(pair, 0) + 1
    return counts

def merge(ids, pair, idx):
    # Exactly as in ERA_V3 code
    newids = []
    i = 0
    while i < len(ids):
        if i < len(ids) - 1 and ids[i] == pair[0] and ids[i+1] == pair[1]:
            newids.append(idx)
            i += 2
        else:
            newids.append(ids[i])
            i += 1
    return newids

# Using same approach for vocabulary building
vocab_size = 400  # Increased from 276 but still well under 5000
num_merges = vocab_size - 256
ids = list(tokens)

merges = {}  # (int, int) -> int
for i in range(num_merges):
    stats = get_stats(ids)
    pair = max(stats, key=stats.get)
    idx = 256 + i
    print(f"merging {pair} into a new token {idx}")
    ids = merge(ids, pair, idx)
    merges[pair] = idx

# Create vocabulary mapping as in ERA_V3
vocab = {idx: bytes([idx]) for idx in range(256)}
for (p0, p1), idx in merges.items():
    vocab[idx] = vocab[p0] + vocab[p1]

def decode(ids):
    # Same as ERA_V3
    tokens = b"".join(vocab[idx] for idx in ids)
    text = tokens.decode('utf-8', errors='replace')
    return text

def encode(text):
    # Same as ERA_V3
    tokens = list(text.encode('utf-8'))
    while len(tokens) >= 2:
        stats = get_stats(tokens)
        pair = min(stats, key=lambda p: merges.get(p, float('inf')))
        if pair not in merges:
            break
        idx = merges[pair]
        tokens = merge(tokens, pair, idx)
    return tokens

print("\nStatistics:")
print(f"Vocabulary Size: {len(merges) + 256}")  # This is what we need to report
print(f"- Base tokens: 256")
print(f"- Merged tokens: {len(merges)}")
print("\nTokens length:", len(tokens))
print("ids length:", len(ids))
print(f"Compression ratio: {len(tokens) / len(ids):.2f}X")

# Test encoding/decoding
test_text = "भारत एक महान देश है"
encoded = encode(test_text)
decoded = decode(encoded)
print(f"\nTest:")
print(f"Original: {test_text}")
print(f"Decoded: {decoded}")

